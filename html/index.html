<!doctype html>
<html>

<head>
	<meta http-equiv='X-UA-Compatible' content='IE=Edge'>
	<meta name='viewport' content='width=device-width, initial-scale=1' />
	<meta charset='utf-8'>

	<title>live monitor – extinfo</title>

	<link href='https://fonts.googleapis.com/css?family=Roboto+Mono:400,700&subset=cyrillic,greek' rel='stylesheet'>
	<link rel='stylesheet' href='/css/style.css'>

	<script src='https://cdnjs.cloudflare.com/ajax/libs/vue/2.0.3/vue.min.js'></script>
	<script src='/js/extinfo.js'></script>
</head>

<body onload='init();' spellcheck='false' class='flex flex-col'>
	<main id='scoreboard' v-bind:style='{ background: makeBackgroundString(info.map) }'>
		<header>
			<h1 class='scrollable-x'>
				{{info.description}}
			</h1>
			<h3 class='scrollable-x'>
				<strong>{{info.gameMode}}</strong> on <strong>{{info.map}}</strong> | {{formatTimeLeft(info.secsLeft)}} | {{info.masterMode}} | {{info.numberOfClients}}/{{info.maxNumberOfClients}}
			</h3>
		</header>
		<section id='teams' class='flex flex-row'>
			<div class='team flex flex-col' v-for='team in teams'>
				<h2>{{team.name}}: {{team.score}}</h2>
				<div class='team-table scrollable-x'>
					<table>
						<thead>
							<tr>
								<td>Frags</td>
								<td>Deaths</td>
								<td>Accuracy</td>
								<td>Name</td>
								<td>CN</td>
							</tr>
						</thead>
						<tbody>
							<tr v-for='player in team.players'>
								<td class='count'>{{player.frags}}</td>
								<td class='count'>{{player.deaths}}</td>
								<td class='count'>{{player.accuracy}}%</td>
								<td>{{player.name}}</td>
								<td class='count'>{{player.clientNum}}</td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
		</section>

		<section id='spectators' v-show='spectators.length > 0'>
			<h2>spectators</h2>
			<div class='flex flex-row centered'>
				<span class='spectator' v-for='spectator in spectators'>{{spectator.name}}&nbsp;({{spectator.clientNum}})</span>
			</div>
		</section>
	</main>

	<aside id='serverlist' class='flex flex-col'>
		<h2>Other Servers</h2>
		<div v-if='servers.length' class='scrollable-x' >
			<table>
				<thead>
					<tr>
						<td>Players</td>
						<td>Description</td>
						<td>Mode</td>
						<td>Map</td>
						<td>Time Left</td>
						<td>Master Mode</td>
					</tr>
				</thead>
				<tbody>
					<tr v-for='server in servers'>
						<td class='count'>{{server.numberOfClients}}</td>
						<td v-if='isTeamMode(server.gameMode)'>
							<a v-bind:href='"#"+server.address' class='subtle'>{{server.description}}</a>
						</td>
						<td v-else>{{server.description}}</td>
						<td>{{server.gameMode}}</td>
						<td>{{server.map}}</td>
						<td class='centered'>{{formatTimeLeft(server.secsLeft)}}</td>
						<td>{{server.masterMode}}</td>
					</tr>
				</tbody>
			</table>
		</div>
		<p v-else class='centered'>
			loading...
		</p>
	</aside>

	<footer class='flex flex-row centered'>
		<small>
			Sauerbraten live monitor by pix.
		</small>
		<small>
			<a href='https://github.com/sauerbraten/extinfo-web'>Code on GitHub</a>
		</small>
	</footer>

	<script>
		function formatTimeLeft(secondsLeft) {
			var pad = function(i) { return (i < 10 ? '0' : '') + i }
			var minutes = pad(Math.floor(secondsLeft/60))
			var seconds = pad(secondsLeft % 60)
			return minutes + ':' + seconds
		}

		var model = {
			info: {
				description: 'loading …',
				gameMode: 'ffa',
				map: 'firstevermap',
				secsLeft: 0,
				masterMode: 'open',
				numberOfClients: 0,
				maxNumberOfClients: 0
			},
			teams: {},
			spectators: [],
			servers: [],
		}

		new Vue({
			el: '#scoreboard',
			data: model,
			methods: {
				makeBackgroundString: function(map) {
					return 'url("//sauertracker.net/images/mapshots/' + map + '.jpg") no-repeat center center / cover, #555'
				}
			}
		})

		new Vue({
			el:'#serverlist',
			data: model,
			methods: {
				isTeamMode: function(mode) {
					return !(['ffa', 'coop edit', 'instagib', 'efficiency', 'tactics'].includes(mode))
				}
			}
		})
	</script>
</body>

</html>