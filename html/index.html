<!doctype html>
<html>

<head>
	<meta http-equiv='X-UA-Compatible' content='IE=Edge'>
	<meta name='viewport' content='width=device-width, initial-scale=1' />
	<meta charset='utf-8'>

	<title>live monitor – extinfo</title>

	<link href='https://fonts.googleapis.com/css?family=Roboto+Mono:400,700&subset=cyrillic,greek' rel='stylesheet'>
	<link rel='stylesheet' href='/style.css'>

	<script src='http://cdnjs.cloudflare.com/ajax/libs/vue/1.0.26/vue.min.js'></script>
	<script src='/extinfo.js'></script>
</head>

<body onload='init();' spellcheck='false'>
	<header id='serverinfo' v-bind:style='{ background: makeBackgroundString(info.map) }'>
		<h1>{{info.description}}</h1>
		<h3>
			<strong>{{info.gameMode}}</strong> on <strong>{{info.map}}</strong> | {{int2string(info.secsLeft)}} | {{info.masterMode}}
			| {{info.numberOfClients}}/{{info.maxNumberOfClients}}
		</h3>
	</header>

	<main>
		<div id='teams' class='players'>
			<div class='team-table' v-for='team in teams'>
				<h2>{{team.name}}: {{team.score}}</h2>
				<table>
					<thead>
						<tr>
							<td>Frags</td>
							<td>Deaths</td>
							<td>Accuracy</td>
							<td>Name</td>
							<td>CN</td>
						</tr>
					</thead>
					<tbody>
						<tr v-for='player in team.players'>
							<td class='count'>{{player.frags}}</td>
							<td class='count'>{{player.deaths}}</td>
							<td class='count'>{{player.accuracy}}%</td>
							<td>{{player.name}}</td>
							<td class='count'>{{player.clientNum}}</td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>

		<div id='spectators' class='spectators' v-show='spectators.length > 0'>
			<h2>spectators</h2>
			<span class='spectator' v-for='spectator in spectators'>{{spectator.name}}&nbsp;({{spectator.clientNum}})</span>
		</div>
	</main>

	<footer>
		<small>
			Sauerbraten server live monitor by pix – <a href='https://github.com/sauerbraten/extinfo-web'>Code</a>
		</small>
	</footer>

	<script>
		var model = {
			info: {map: 'firstevermap'},
			teams: {},
			spectators: [],
		}

		new Vue({
			el: '#serverinfo',
			data: model,
			methods: {
				int2string: function(secondsLeft) {
					var minutes = Math.floor(secondsLeft/60)
					var seconds = secondsLeft % 60
					return (minutes < 10 ? '0' : '') + minutes + ':' + (seconds < 10 ? '0' : '') + seconds
				},
				makeBackgroundString: function(map) {
					return 'url("//sauertracker.net/images/mapshots/' + map + '.jpg") no-repeat center center / cover'
				}
			}
		})

		new Vue({
			el: '#teams',
			data: model,
		})

				new Vue({
			el: '#spectators',
			data: model,
		})
	</script>
</body>
</html>